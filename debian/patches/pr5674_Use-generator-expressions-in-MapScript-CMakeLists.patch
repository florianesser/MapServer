From a2d9b0f0a9416bd2d1bd6e38445388e3d9adff32 Mon Sep 17 00:00:00 2001
From: Seth G <geographika@gmail.com>
Date: Fri, 5 Oct 2018 00:29:03 +0200
Subject: [PATCH 1/3] Use generator expressions in CMake

See #5646
Also standardise commands in lower-case
---
 mapscript/perl/CMakeLists.txt | 16 +++++++---------
 1 file changed, 7 insertions(+), 9 deletions(-)

--- a/mapscript/perl/CMakeLists.txt
+++ b/mapscript/perl/CMakeLists.txt
@@ -9,7 +9,12 @@ include_directories(${PROJECT_SOURCE_DIR
 add_definitions(${PERL_EXTRA_C_FLAGS})
 SET(CMAKE_SWIG_FLAGS -shadow -w314)
 include_directories(${PROJECT_SOURCE_DIR}/mapscript/perl)
-SWIG_ADD_MODULE(perlmapscript perl5 ../mapscript.i)
+
+if (${CMAKE_MAJOR_VERSION}.${CMAKE_MINOR_VERSION} VERSION_GREATER 3.7)
+    swig_add_library(perlmapscript TYPE MODULE LANGUAGE perl5 SOURCES ../mapscript.i)
+else ()
+    swig_add_module(perlmapscript perl5 ../mapscript.i)
+endif ()
 
 SWIG_LINK_LIBRARIES(perlmapscript ${PERL_LIBRARIES} ${MAPSERVER_LIBMAPSERVER})
 set_target_properties(perlmapscript PROPERTIES OUTPUT_NAME mapscript)
@@ -18,8 +23,5 @@ if(APPLE)
   set_target_properties(perlmapscript PROPERTIES SUFFIX ".bundle")
 endif(APPLE)
 
-get_target_property(LOC_MAPSCRIPT_LIB ${SWIG_MODULE_perlmapscript_REAL_NAME} LOCATION)
-set(mapscript_files ${LOC_MAPSCRIPT_LIB} ${CMAKE_CURRENT_BINARY_DIR}/mapscript.pm)
-install(FILES ${LOC_MAPSCRIPT_LIB} DESTINATION ${CUSTOM_PERL_VENDOR_ARCH_DIR}/auto/mapscript)
-install(FILES ${CMAKE_CURRENT_BINARY_DIR}/mapscript.pm DESTINATION ${CUSTOM_PERL_VENDOR_ARCH_DIR})
-
+install(FILES $<TARGET_FILE:${SWIG_MODULE_perlmapscript_REAL_NAME}> DESTINATION ${CUSTOM_PERL_VENDOR_ARCH_DIR}/auto/mapscript)
+install(FILES $<TARGET_FILE_DIR:${SWIG_MODULE_perlmapscript_REAL_NAME}>/mapscript.pm DESTINATION ${CUSTOM_PERL_VENDOR_ARCH_DIR})
--- a/mapscript/java/CMakeLists.txt
+++ b/mapscript/java/CMakeLists.txt
@@ -13,7 +13,6 @@ include_directories(${PROJECT_SOURCE_DIR
 include_directories(${PROJECT_SOURCE_DIR}/mapscript/java)
 SET (CMAKE_SWIG_OUTDIR "${CMAKE_CURRENT_BINARY_DIR}/edu/umn/gis/mapscript")
 SET(CMAKE_SWIG_FLAGS -package edu.umn.gis.mapscript)
-SWIG_ADD_MODULE(javamapscript java ../mapscript.i)
 
 # Java mapscript fails to build with -Werror=format-security
 
@@ -32,6 +31,12 @@ if(${CMAKE_CPP_FLAGS} MATCHES "-Werror=f
   set(CMAKE_CPP_FLAGS "${TMP}")
 endif(${CMAKE_CPP_FLAGS} MATCHES "-Werror=format-security")
 
+if (${CMAKE_MAJOR_VERSION}.${CMAKE_MINOR_VERSION} VERSION_GREATER 3.7)
+    swig_add_library(javamapscript TYPE MODULE LANGUAGE java SOURCES ../mapscript.i)
+else ()
+    swig_add_module(javamapscript java ../mapscript.i)
+endif ()
+
 SWIG_LINK_LIBRARIES(javamapscript ${MAPSERVER_LIBMAPSERVER})
 
 ADD_CUSTOM_COMMAND(TARGET javamapscript
@@ -42,6 +47,6 @@ ADD_CUSTOM_COMMAND(TARGET javamapscript
                       COMMENT "Compiling java source files, creating mapscript.jar"
                       )
 
-get_target_property(LOC_MAPSCRIPT_LIB ${SWIG_MODULE_javamapscript_REAL_NAME} LOCATION)
-install(FILES ${LOC_MAPSCRIPT_LIB} DESTINATION lib/jni)
+set(mapscript_files $<TARGET_FILE:${SWIG_MODULE_javamapscript_REAL_NAME}>)
+install(FILES ${mapscript_files} DESTINATION lib/jni)
 install(FILES ${CMAKE_CURRENT_BINARY_DIR}/mapscript.jar DESTINATION share/java)
--- a/mapscript/ruby/CMakeLists.txt
+++ b/mapscript/ruby/CMakeLists.txt
@@ -5,7 +5,6 @@ INCLUDE_DIRECTORIES(${RUBY_INCLUDE_DIRS}
 include_directories(${PROJECT_SOURCE_DIR}/mapscript/swiginc)
 include_directories(${PROJECT_SOURCE_DIR}/mapscript/)
 include_directories(${PROJECT_SOURCE_DIR}/mapscript/ruby)
-SWIG_ADD_MODULE(rubymapscript ruby ../mapscript.i)
 
 # Ruby mapscript fails to build with -Werror=format-security
 
@@ -24,6 +23,12 @@ if(${CMAKE_CPP_FLAGS} MATCHES "-Werror=f
   set(CMAKE_CPP_FLAGS "${TMP}")
 endif(${CMAKE_CPP_FLAGS} MATCHES "-Werror=format-security")
 
+if (${CMAKE_MAJOR_VERSION}.${CMAKE_MINOR_VERSION} VERSION_GREATER 3.7)
+    swig_add_library(rubymapscript TYPE MODULE LANGUAGE ruby SOURCES ../mapscript.i)
+else ()
+    SWIG_ADD_MODULE(rubymapscript ruby ../mapscript.i)
+endif ()
+
 SWIG_LINK_LIBRARIES(rubymapscript ${RUBY_LIBRARY} ${MAPSERVER_LIBMAPSERVER})
 
 set_target_properties(${SWIG_MODULE_rubymapscript_REAL_NAME} PROPERTIES PREFIX "")
@@ -32,6 +37,6 @@ if(APPLE)
   set_target_properties(${SWIG_MODULE_rubymapscript_REAL_NAME} PROPERTIES SUFFIX ".bundle")
 endif(APPLE)
 
-get_target_property(LOC_MAPSCRIPT_LIB ${SWIG_MODULE_rubymapscript_REAL_NAME} LOCATION)
+set(mapscript_files $<TARGET_FILE:${SWIG_MODULE_rubymapscript_REAL_NAME}>)
 execute_process(COMMAND ${RUBY_EXECUTABLE} -r rbconfig -e "puts RbConfig::CONFIG['vendorarchdir']" OUTPUT_VARIABLE RUBY_VENDORARCHDIR OUTPUT_STRIP_TRAILING_WHITESPACE)
-install(FILES ${LOC_MAPSCRIPT_LIB} DESTINATION ${RUBY_VENDORARCHDIR})
+install(FILES ${mapscript_files} DESTINATION ${RUBY_VENDORARCHDIR})
