#! /bin/sh /usr/share/dpatch/dpatch-run
## 02_CVE-2009-0840.dpatch by Alan Boudreault <aboudreault@mapgears.com>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: No description.

@DPATCH@
diff -urNad mapserver-5.0.3~/cgiutil.c mapserver-5.0.3/cgiutil.c
--- mapserver-5.0.3~/cgiutil.c	2007-08-31 17:40:06.000000000 -0400
+++ mapserver-5.0.3/cgiutil.c	2009-06-08 13:34:21.651859515 -0400
@@ -41,7 +41,8 @@
 static char *readPostBody( cgiRequestObj *request ) 
 {
   char *data; 
-  int data_max, data_len, chunk_size;
+  unsigned int data_max, data_len; 
+  int chunk_size;
 
   msIO_needBinaryStdin();
 
@@ -53,7 +54,7 @@
     data = (char *) malloc(data_max+1);
     if( data == NULL ) {
       msIO_printf("Content-type: text/html%c%c",10,10);
-      msIO_printf("malloc() failed, Content-Length: %d unreasonably large?\n", data_max );
+      msIO_printf("malloc() failed, Content-Length: %u unreasonably large?\n", data_max );
       exit( 1 );
     }
 
@@ -83,7 +84,7 @@
 
       if( data == NULL ) {
         msIO_printf("Content-type: text/html%c%c",10,10);
-        msIO_printf("out of memory trying to allocate %d input buffer, POST body too large?\n", data_max+1 );
+        msIO_printf("out of memory trying to allocate %u input buffer, POST body too large?\n", data_max+1 );
         exit(1);
       }
     }
