#! /bin/sh /usr/share/dpatch/dpatch-run
## 03_CVE-2009-0841.dpatch by Alan Boudreault <aboudreault@mapgears.com>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: No description.

@DPATCH@
diff -urNad mapserver-5.0.3~/mapserv.c mapserver-5.0.3/mapserv.c
--- mapserver-5.0.3~/mapserv.c	2007-09-10 09:51:19.000000000 -0400
+++ mapserver-5.0.3/mapserv.c	2009-06-08 13:35:11.130609480 -0400
@@ -1585,7 +1585,7 @@
         if(msReturnTemplateQuery(msObj, msObj->Map->web.queryformat, NULL) != MS_SUCCESS) writeError();
           
         if(msObj->SaveQuery) {
-          sprintf(buffer, "%s%s%s%s", msObj->Map->web.imagepath, msObj->Map->name, msObj->Id, MS_QUERY_EXTENSION);
+          snprintf(buffer, sizeof(buffer), "%s%s%s%s", msObj->Map->web.imagepath, msObj->Map->name, msObj->Id, MS_QUERY_EXTENSION);
           if((status = msSaveQuery(msObj->Map, buffer)) != MS_SUCCESS) return status;
         }
       }
