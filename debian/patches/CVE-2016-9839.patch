Description: Backport #4928 and #5356
Author: Thomas Bonfort <thomas.bonfort@gmail.com>
Origin: https://github.com/mapserver/mapserver/commit/022d24bd34196b6dca67053fb797a6980210bc54

--- a/mapogr.cpp
+++ b/mapogr.cpp
@@ -1166,18 +1166,15 @@ msOGRFileOpen(layerObj *layer, const cha
     RELEASE_OGR_LOCK;
 
     if( hDS == NULL ) {
-      if( strlen(CPLGetLastErrorMsg()) == 0 )
-        msSetError(MS_OGRERR,
-                   "Open failed for OGR connection in layer `%s'.  "
-                   "File not found or unsupported format.",
-                   "msOGRFileOpen()",
-                   layer->name?layer->name:"(null)" );
-      else
-        msSetError(MS_OGRERR,
-                   "Open failed for OGR connection in layer `%s'.\n%s\n",
-                   "msOGRFileOpen()",
-                   layer->name?layer->name:"(null)",
-                   CPLGetLastErrorMsg() );
+      msSetError(MS_OGRERR, 
+                "Open failed for OGR connection in layer `%s'.  "
+                "Check logs.", 
+                "msOGRFileOpen()",
+                layer->name?layer->name:"(null)" );
+      if( strlen(CPLGetLastErrorMsg()) != 0 )
+          msDebug("Open failed for OGR connection in layer `%s'.\n%s\n",
+                  layer->name?layer->name:"(null)", 
+                  CPLGetLastErrorMsg() );
       CPLFree( pszDSName );
       CPLFree( pszLayerDef );
       return NULL;
@@ -1202,10 +1199,13 @@ msOGRFileOpen(layerObj *layer, const cha
     ACQUIRE_OGR_LOCK;
     hLayer = OGR_DS_ExecuteSQL( hDS, pszLayerDef, NULL, NULL );
     if( hLayer == NULL ) {
-      msSetError(MS_OGRERR,
-                 "ExecuteSQL(%s) failed.\n%s",
-                 "msOGRFileOpen()",
-                 pszLayerDef, CPLGetLastErrorMsg() );
+      msSetError(MS_OGRERR, 
+              "ExecuteSQL(%s) failed. Check logs",
+              "msOGRFileOpen()", 
+              pszLayerDef);
+      msDebug(
+              "ExecuteSQL(%s) failed.\n%s",
+              pszLayerDef, CPLGetLastErrorMsg() );
       RELEASE_OGR_LOCK;
       msConnPoolRelease( layer, hDS );
       CPLFree( pszLayerDef );
@@ -1237,9 +1237,11 @@ msOGRFileOpen(layerObj *layer, const cha
   }
 
   if (hLayer == NULL) {
-    msSetError(MS_OGRERR, "GetLayer(%s) failed for OGR connection `%s'.",
-               "msOGRFileOpen()",
-               pszLayerDef, connection );
+    msSetError(MS_OGRERR, "GetLayer(%s) failed for OGR connection. Check logs.",
+                "msOGRFileOpen()", 
+                pszLayerDef);
+    msDebug("GetLayer(%s) failed for OGR connection `%s'.",
+                pszLayerDef, connection );
     CPLFree( pszLayerDef );
     msConnPoolRelease( layer, hDS );
     return NULL;
@@ -1662,7 +1664,14 @@ static int msOGRFileWhichShapes(layerObj
 
     CPLErrorReset();
     if( OGR_L_SetAttributeFilter( psInfo->hLayer, pszOGRFilter ) != OGRERR_NONE ) {
-      msSetError(MS_OGRERR, "SetAttributeFilter(%s) failed on layer %s.\n%s", "msOGRFileWhichShapes()", layer->filter.string+6, layer->name?layer->name:"(null)", CPLGetLastErrorMsg() );
+      msSetError(MS_OGRERR,
+                 "SetAttributeFilter(%s) failed on layer %s.",
+                 "msOGRFileWhichShapes()",
+                 layer->filter.string+6,
+                 layer->filter.string+6, layer->name?layer->name:"(null)");
+      msDebug("SetAttributeFilter(%s) failed on layer %s.\n%s", 
+              layer->filter.string+6, layer->name?layer->name:"(null)", 
+              CPLGetLastErrorMsg() );
       RELEASE_OGR_LOCK;
       msFree(pszOGRFilter);
       return MS_FAILURE;
@@ -1875,8 +1884,8 @@ msOGRFileNextShape(layerObj *layer, shap
     if( (hFeature = OGR_L_GetNextFeature( psInfo->hLayer )) == NULL ) {
       psInfo->last_record_index_read = -1;
       if( CPLGetLastErrorType() == CE_Failure ) {
-        msSetError(MS_OGRERR, "%s", "msOGRFileNextShape()",
-                   CPLGetLastErrorMsg() );
+        msSetError(MS_OGRERR, "OGR error. check logs", "msOGRFileNextShape()");
+        msDebug("msOGRFileNextShape() error: %s", CPLGetLastErrorMsg() );
         RELEASE_OGR_LOCK;
         return MS_FAILURE;
       } else {
