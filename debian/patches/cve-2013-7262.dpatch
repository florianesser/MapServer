#! /bin/sh /usr/share/dpatch/dpatch-run
## cve-2013-7262.dpatch by Bas Couwenberg <sebastic@xs4all.nl>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: No description.

@DPATCH@
diff -urNad '--exclude=CVS' '--exclude=.svn' '--exclude=.git' '--exclude=.arch' '--exclude=.hg' '--exclude=_darcs' '--exclude=.bzr' mapserver~/mappostgis.c mapserver/mappostgis.c
--- mapserver~/mappostgis.c	2014-01-08 22:42:12.000000000 +0100
+++ mapserver/mappostgis.c	2014-01-08 22:42:18.000000000 +0100
@@ -2153,6 +2153,11 @@
     if (!lp || !timestring || !timefield)
       return MS_FALSE;
 
+    if( strchr(timestring,'\'') || strchr(timestring, '\\') ) {
+       msSetError(MS_MISCERR, "Invalid time filter.", "msPostGISLayerSetTimeFilter()");
+       return MS_FALSE;
+    }
+
     if (strstr(timestring, ",") == NULL && 
         strstr(timestring, "/") == NULL) /* discrete time */
       tmpstimestring = strdup(timestring);
