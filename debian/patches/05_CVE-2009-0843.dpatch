#! /bin/sh /usr/share/dpatch/dpatch-run
## 05_CVE-2009-0843.dpatch by Alan Boudreault <aboudreault@mapgears.com>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: No description.

@DPATCH@
diff -urNad mapserver-5.0.3~/mapquery.c mapserver-5.0.3/mapquery.c
--- mapserver-5.0.3~/mapquery.c	2008-05-05 10:46:11.000000000 -0400
+++ mapserver-5.0.3/mapquery.c	2009-06-08 13:36:44.410605642 -0400
@@ -120,6 +120,11 @@
     return(MS_FAILURE);
   }
 
+  /* 
+  ** Make sure the file at least has the right extension. 
+  */ 
+  if(msEvalRegex("\\.qy$", filename) != MS_TRUE) return MS_FAILURE; 
+
   stream = fopen(filename, "rb");
   if(!stream) {
     msSetError(MS_IOERR, "(%s)", "msLoadQuery()", filename);
