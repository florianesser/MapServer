#! /bin/sh /usr/share/dpatch/dpatch-run
## 84_CVE-2009-0841.dpatch by Alan Boudreault <aboudreault@mapgears.com>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: No description.

@DPATCH@
diff -urNad mapserver-4.10.0~/mapserv.c mapserver-4.10.0/mapserv.c
--- mapserver-4.10.0~/mapserv.c	2006-08-28 21:56:53.000000000 -0400
+++ mapserver-4.10.0/mapserv.c	2009-07-14 13:10:06.254163494 -0400
@@ -1595,7 +1595,7 @@
           if (msReturnTemplateQuery(msObj, msObj->Map->web.queryformat, NULL) != MS_SUCCESS) writeError();
           
           if(msObj->SaveQuery) {
-             sprintf(buffer, "%s%s%s%s", msObj->Map->web.imagepath, msObj->Map->name, msObj->Id, MS_QUERY_EXTENSION);
+	    snprintf(buffer, sizeof(buffer), "%s%s%s%s", msObj->Map->web.imagepath, msObj->Map->name, msObj->Id, MS_QUERY_EXTENSION);
              if((status = msSaveQuery(msObj->Map, buffer)) != MS_SUCCESS) return status;
           }
        }
